<!-- SIMULATEUR PPPT - Code pour Webflow avec Auto-Update depuis GitHub -->
<!-- Collez ce code dans un √©l√©ment "Embed" dans Webflow -->

<style>
.pppt-iframe-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0;
}

.pppt-iframe-wrapper {
    position: relative;
    width: 100%;
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    overflow: visible;
}

.pppt-iframe-wrapper iframe {
    width: 100%;
    min-height: 1200px;
    border: none;
    border-radius: 24px;
    display: block;
    overflow: hidden;
}

/* Loader pendant le chargement */
.pppt-loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    z-index: 1;
}

.pppt-loader-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f4f6;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    animation: pppt-spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes pppt-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.pppt-loader-text {
    color: #6b7280;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 0.875rem;
}

/* Responsive */
@media (max-width: 768px) {
    .pppt-iframe-wrapper iframe {
        min-height: 1600px;
    }
}
</style>

<div class="pppt-iframe-container">
    <div class="pppt-iframe-wrapper">
        <!-- Loader -->
        <div class="pppt-loader" id="pppt-loader">
            <div class="pppt-loader-spinner"></div>
            <div class="pppt-loader-text">Chargement du simulateur...</div>
        </div>

        <!-- Iframe vers Vercel - SE MET √Ä JOUR AUTOMATIQUEMENT -->
        <iframe
            id="pppt-iframe"
            src=""
            title="Simulateur PPPT"
            loading="lazy"
            scrolling="no"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            onload="onIframeLoad()">
        </iframe>
    </div>
</div>

<script>
// Fonction pour r√©cup√©rer les param√®tres URL de la page Webflow
function getUrlParameters() {
    const params = new URLSearchParams(window.location.search);
    return params.toString();
}

// Construire l'URL de l'iframe avec les param√®tres
function buildIframeUrl() {
    const baseUrl = 'https://simulateur-pppt.vercel.app/';
    const params = getUrlParameters();

    if (params) {
        return baseUrl + '?' + params;
    }
    return baseUrl;
}

// D√©finir l'URL de l'iframe au chargement
document.addEventListener('DOMContentLoaded', function() {
    const iframe = document.getElementById('pppt-iframe');
    if (iframe) {
        iframe.src = buildIframeUrl();
        console.log('üìç Iframe URL:', iframe.src);
    }
});

// √âcouter les messages de l'iframe pour ajuster la hauteur dynamiquement
window.addEventListener('message', function(event) {
    // S√©curit√©: v√©rifier l'origine (Vercel)
    if (event.origin !== 'https://simulateur-pppt.vercel.app') {
        return;
    }

    // V√©rifier le type de message
    if (event.data && event.data.type === 'pppt-resize') {
        const iframe = document.getElementById('pppt-iframe');
        const loader = document.getElementById('pppt-loader');

        // Cacher le loader
        if (loader) {
            loader.style.display = 'none';
        }

        // Ajuster la hauteur de l'iframe
        if (iframe && event.data.height) {
            iframe.style.height = event.data.height + 'px';
        }
    }
});

// Fonction de secours au chargement initial
function onIframeLoad() {
    const loader = document.getElementById('pppt-loader');
    if (loader) {
        loader.style.display = 'none';
    }
}
</script>
